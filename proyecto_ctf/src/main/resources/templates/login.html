<!DOCTYPE html>
<html lang=es layout:decorate="~{layout/login_layout}">

<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <!-- Link to the external JS file -->
    <!--<script>

        document.addEventListener("DOMContentLoaded", function () {
            const loginForm = document.getElementById("loginForm");
            const errorMessage = document.getElementById("error-message");

            loginForm.addEventListener("submit", function (event) {
                event.preventDefault();

                const formData = new FormData(loginForm);
                const username = formData.get("username");
                const password = formData.get("password");

                const data = {
                    username,
                    password,
                };

                fetch("/api/auth/loginform", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(data),
                    credentials: "include",  // Make sure to send cookies
                    redirect: "follow",  // Follow redirects automatically
                }).then((response) => {
                    if (response.ok) {
                        // The backend will automatically handle the redirection to /dashboard
                        // No need to manually handle the redirect
                        // The browser will navigate to the location set in the backend (e.g., /dashboard)
                    } else {
                        throw new Error("Invalid username or password.");
                    }
                }).catch((error) => {
                    errorMessage.textContent = error.message || "An error occurred during login.";
                    errorMessage.style.display = "block";
                });
            });
        });
    </script>-->
</head>

<!--<body>
    <h2>Please Sign In</h2>

    <form id="loginForm" method="post">
        <div>
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>
        </div>
        <div>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
        </div>
        <div>
            <button type="submit">Login</button>
        </div>

        <div id="error-message" style="color:red; display:none;">
            <p>Invalid username or password.</p>
        </div>
    </form>

</body>-->

<body>
    <main layout:fragment="main">
        <div class="container vw-100">
            <div class="row w-100 justify-content-center">
                <div class="col-10 col-sm-8 col-md-6 col-lg-4 bgreen3 rounded border border-dark mt-5">
                    <form id="loginForm" class="p-0" th:action="@{/api/auth/loginform}" method="post">
                        <label class="form-label col-3 mb-4 mt-5" th:text="#{user.username}"></label>
                        <input th:type="text" name="username" placeholder="myname"
                            class="col-6 bcream rounded-pill border border-dark">
                        <label class="form-label col-3 mt-4" th:text="#{user.password}"></label>
                        <input th:type="password" name="password" placeholder="mypassword"
                            class="col-6 bcream rounded-pill border border-dark mb-3">
                        <button type="submit" class="shadow-sm btn bgreen1 col-3 border border-dark mb-3"
                            th:text="#{button.login}"></button>
                    </form>
                </div>
                <div class="row align-items-center justify-content-center d-inline">
                    <p th:text="#{message.no-account}"></p><a th:href="@{/create}" th:text="#{message.click-here}"></a>
                </div>
            </div>
        </div>
    </main>
</body>

</html>